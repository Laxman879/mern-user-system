<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester - MERN User System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .endpoint { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 8px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .response { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; }
        input, textarea { padding: 5px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
        .auth-info { background: #e7f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>API Tester - MERN User System</h1>
        <p><strong>Base URL:</strong> https://mern-user-system-backend.vercel.app</p>
        
        <div class="auth-info">
            <strong>Auth Token:</strong> <span id="currentToken">Not logged in</span>
            <button onclick="clearToken()">Clear Token</button>
        </div>

        <!-- Root & Test Routes -->
        <div class="endpoint">
            <h3>GET / (Root Route)</h3>
            <button onclick="testAPI('GET', '/')">Test Root Route</button>
            <div id="response-root" class="response"></div>
        </div>

        <div class="endpoint">
            <h3>GET /test</h3>
            <button onclick="testAPI('GET', '/test')">Test Route</button>
            <div id="response-test" class="response"></div>
        </div>

        <!-- Auth APIs -->
        <div class="endpoint">
            <h3>POST /api/auth/register</h3>
            <input type="text" id="reg-username" placeholder="Username" value="testuser">
            <input type="email" id="reg-email" placeholder="Email" value="test@example.com">
            <input type="password" id="reg-password" placeholder="Password" value="123456">
            <button onclick="register()">Register</button>
            <div id="response-register" class="response"></div>
        </div>

        <div class="endpoint">
            <h3>POST /api/auth/login</h3>
            <input type="email" id="login-email" placeholder="Email" value="test@example.com">
            <input type="password" id="login-password" placeholder="Password" value="123456">
            <button onclick="login()">Login</button>
            <div id="response-login" class="response"></div>
        </div>

        <div class="endpoint">
            <h3>POST /api/auth/logout</h3>
            <button onclick="testAPI('POST', '/api/auth/logout', null, true)">Logout</button>
            <div id="response-logout" class="response"></div>
        </div>

        <!-- User APIs -->
        <div class="endpoint">
            <h3>GET /api/users (Admin only)</h3>
            <button onclick="testAPI('GET', '/api/users', null, true)">Get All Users</button>
            <div id="response-users" class="response"></div>
        </div>

        <div class="endpoint">
            <h3>GET /api/users/me</h3>
            <button onclick="testAPI('GET', '/api/users/me', null, true)">Get My Profile</button>
            <div id="response-profile" class="response"></div>
        </div>

        <!-- Task APIs -->
        <div class="endpoint">
            <h3>GET /api/tasks</h3>
            <button onclick="testAPI('GET', '/api/tasks', null, true)">Get My Tasks</button>
            <div id="response-tasks" class="response"></div>
        </div>

        <div class="endpoint">
            <h3>POST /api/tasks</h3>
            <input type="text" id="task-title" placeholder="Task Title" value="Test Task">
            <textarea id="task-description" placeholder="Task Description">Test task description</textarea>
            <input type="date" id="task-dueDate">
            <button onclick="createTask()">Create Task</button>
            <div id="response-create-task" class="response"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://mern-user-system-backend.vercel.app';
        let authToken = localStorage.getItem('testToken');
        
        function updateTokenDisplay() {
            document.getElementById('currentToken').textContent = authToken ? 'Logged in' : 'Not logged in';
        }
        
        function clearToken() {
            authToken = null;
            localStorage.removeItem('testToken');
            updateTokenDisplay();
        }
        
        updateTokenDisplay();

        async function testAPI(method, endpoint, data = null, requireAuth = false) {
            const responseId = 'response-' + endpoint.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
            const responseDiv = document.getElementById(responseId) || document.getElementById('response-' + method.toLowerCase());
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                };
                
                if (requireAuth && authToken) {
                    options.headers['Authorization'] = `Bearer ${authToken}`;
                }
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(BASE_URL + endpoint, options);
                const result = await response.json();
                
                if (responseDiv) {
                    responseDiv.textContent = `Status: ${response.status}\n${JSON.stringify(result, null, 2)}`;
                    responseDiv.style.background = response.ok ? '#d4edda' : '#f8d7da';
                }
                
                return result;
            } catch (error) {
                if (responseDiv) {
                    responseDiv.textContent = `Error: ${error.message}`;
                    responseDiv.style.background = '#f8d7da';
                }
            }
        }

        async function register() {
            const data = {
                username: document.getElementById('reg-username').value,
                email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-password').value
            };
            
            const result = await testAPI('POST', '/api/auth/register', data);
            document.getElementById('response-register').textContent = `Status: 201\n${JSON.stringify(result, null, 2)}`;
        }

        async function login() {
            const data = {
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-password').value
            };
            
            try {
                const response = await fetch(BASE_URL + '/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.accessToken) {
                    authToken = result.accessToken;
                    localStorage.setItem('testToken', authToken);
                    updateTokenDisplay();
                }
                
                document.getElementById('response-login').textContent = `Status: ${response.status}\n${JSON.stringify(result, null, 2)}`;
                document.getElementById('response-login').style.background = response.ok ? '#d4edda' : '#f8d7da';
            } catch (error) {
                document.getElementById('response-login').textContent = `Error: ${error.message}`;
            }
        }

        async function createTask() {
            const data = {
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                dueDate: document.getElementById('task-dueDate').value
            };
            
            await testAPI('POST', '/api/tasks', data, true);
        }

        // Set default due date to tomorrow
        document.getElementById('task-dueDate').value = new Date(Date.now() + 86400000).toISOString().split('T')[0];
    </script>
</body>
</html>